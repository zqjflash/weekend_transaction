## 基于域名的多租户空间隔离方案设计

### 背景

随着我们平台的成熟和bff in serverless架构实践经验的推广，对我们平台感兴趣的外部用户会逐渐增多，我们需要尽快上线对多租户空间的支持，开辟一个公共空间给尝鲜试用的用户，不对外暴露我们自己的业务应用，同时也给准备正式接入使用的团队申请独立的租户空间，通过独立的域名访问，提升他们的体验。

### 方案设计

* 隔离机制：每个租户都拥有一个独立的域名以及唯一domain标识，每个租户可以设置一个独立的门户主页，租户空间的配置信息、应用分类、辖属应用等，都带有这个domain标识；
* 分发机制：Proxy层根据请求的访问域名，在转发API请求时往请求头设置一个domain标识，以分发到不同的租户空间。后续可以按照这个策略灵活配置不同租户空间的服务器集群；
* 权限机制：每个租户支持设立一个登陆权限，取得权限的用户才能访问该租户空间下的应用和门户主页；
* 通用domain：设立一个通用的domain(common)，其下的所有应用是平台开放给所有租户的通用应用，租户可以自由选择需要引入的通用应用集合（开发者中心为必选），后续可以考虑支持让租户来提交通用应用，实现多租户间的应用共享，最大化技术和业务沉淀；
* 公共domain：创建一个公共的domain(public)，提供给不具备独立租户空间的用户使用，我们开发的demo应用也可以放到这个空间上。

### 平台表结构设计

* db表设计：包含domain字段，包含3个值（业务/通用/公共）3个空间中；

